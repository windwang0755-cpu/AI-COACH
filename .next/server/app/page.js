(()=>{var e={};e.id=931,e.ids=[931],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},716:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>o.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>c,routeModule:()=>h,tree:()=>d}),s(502),s(1506),s(5866);var r=s(3191),a=s(8716),n=s(7922),o=s.n(n),i=s(5231),l={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);s.d(t,l);let d=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,502)),"/workspaces/AI-COACH/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,1506)),"/workspaces/AI-COACH/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/workspaces/AI-COACH/app/page.tsx"],u="/page",x={require:s,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},7423:(e,t,s)=>{Promise.resolve().then(s.bind(s,230))},7731:()=>{},3226:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},230:(e,t,s)=>{"use strict";s.d(t,{default:()=>y});var r,a=s(326),n=s(7577);!function(e){e.USER="user",e.AI="ai"}(r||(r={}));let o={id:"initial",role:r.AI,text:"Hello, I'm your personal AI coach, you can ask me anything about fitness and workouts."},i=["推荐3个有效的自重训练动作","建议一顿健康的训练后餐食","我如何提高身体柔韧性？"],l=()=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),d=()=>(0,a.jsxs)("header",{className:"flex items-center p-4 border-b border-gray-200 bg-white sticky top-0 z-10",children:[a.jsx("button",{className:"p-1 -ml-1","aria-label":"Go back",children:a.jsx(l,{})}),a.jsx("h1",{className:"text-lg font-semibold text-gray-800 text-center flex-grow -ml-6",children:"AI Coach"})]}),c=()=>(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-1 p-1",children:[a.jsx("div",{className:"w-1.5 h-1.5 bg-gray-500 rounded-full animate-pulse [animation-delay:-0.3s]"}),a.jsx("div",{className:"w-1.5 h-1.5 bg-gray-500 rounded-full animate-pulse [animation-delay:-0.15s]"}),a.jsx("div",{className:"w-1.5 h-1.5 bg-gray-500 rounded-full animate-pulse"})]}),u=()=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),x=()=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h5M20 20v-5h-5M4 4a14.95 14.95 0 0113.138 5.5M20 20a14.95 14.95 0 01-13.138-5.5"})}),h=({message:e,isLastMessage:t,isLoading:s,onRegenerate:n})=>{let o=e.role===r.USER,i=e.role===r.AI;return(0,a.jsxs)("div",{className:`flex items-start gap-2.5 ${o?"justify-end":""}`,children:[i&&a.jsx("img",{src:"https://picsum.photos/seed/aicoach/40/40",alt:"AI Coach",className:"w-8 h-8 rounded-full flex-shrink-0"}),(0,a.jsxs)("div",{className:`flex flex-col gap-1 w-full max-w-[85%] ${o?"items-end":"items-start"}`,children:[a.jsx("div",{className:`rounded-2xl px-4 py-2.5 shadow-sm ${o?"bg-blue-600 text-white rounded-br-lg":"bg-gray-100 text-gray-800 rounded-bl-lg"}`,children:i&&s&&t&&0===e.text.length?a.jsx(c,{}):a.jsx("p",{className:"whitespace-pre-wrap text-base",children:e.text})}),i&&!s&&t&&"initial"!==e.id&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[a.jsx("button",{onClick:()=>{navigator.clipboard.writeText(e.text)},"aria-label":"Copy message",className:"p-1.5 text-gray-500 hover:bg-gray-200 rounded-full transition-colors",children:a.jsx(u,{})}),a.jsx("button",{onClick:n,"aria-label":"Regenerate response",className:"p-1.5 text-gray-500 hover:bg-gray-200 rounded-full transition-colors",children:a.jsx(x,{})})]})]})]})},p=({messages:e,isLoading:t,onRegenerate:s})=>{let r=(0,n.useRef)(null);return(0,n.useEffect)(()=>{r.current?.scrollIntoView({behavior:"smooth"})},[e]),(0,a.jsxs)("main",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[a.jsx("div",{role:"log",className:"space-y-4",children:e.map((r,n)=>a.jsx(h,{message:r,isLastMessage:n===e.length-1,isLoading:t,onRegenerate:s},r.id))}),a.jsx("div",{ref:r})]})},g=({disabled:e})=>(0,a.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("path",{d:"M22 2L11 13",stroke:e?"#4B5563":"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),a.jsx("path",{d:"M22 2L15 22L11 13L2 9L22 2Z",stroke:e?"#4B5563":"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),m=({onSend:e,isLoading:t})=>{let[s,r]=(0,n.useState)(""),o=(0,n.useRef)(null),i=a=>{a.preventDefault(),s.trim()&&!t&&(e(s),r(""),o.current&&(o.current.style.height="auto"))};return a.jsx("footer",{className:"bg-white p-2 sticky bottom-0 border-t border-gray-200",children:(0,a.jsxs)("form",{onSubmit:i,className:"flex items-end gap-2 bg-gray-800 rounded-xl p-2",children:[a.jsx("textarea",{ref:o,value:s,onChange:e=>{r(e.target.value)},onInput:()=>{let e=o.current;e&&(e.style.height="auto",e.style.height=`${Math.min(e.scrollHeight,128)}px`)},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),i(e))},placeholder:"输入任何内容...",className:"flex-1 bg-transparent text-white placeholder-gray-400 focus:outline-none resize-none overflow-y-auto text-base py-2 px-2",rows:1,disabled:t,"aria-label":"Chat input"}),a.jsx("button",{type:"submit",disabled:t||!s.trim(),className:"w-10 h-10 flex items-center justify-center rounded-full transition-colors duration-200 disabled:bg-gray-600 bg-blue-600 hover:bg-blue-700 flex-shrink-0","aria-label":"Send message",children:a.jsx(g,{disabled:t||!s.trim()})})]})})},f=()=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h5M20 20v-5h-5M4 4a14.95 14.95 0 0113.138 5.5M20 20a14.95 14.95 0 01-13.138-5.5"})}),b=({prompts:e,onSelect:t})=>(0,a.jsxs)("div",{className:"px-4 pb-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"你可以这样问"}),a.jsx("button",{className:"p-1 hover:bg-gray-200 rounded-full","aria-label":"Refresh suggestions",children:a.jsx(f,{})})]}),a.jsx("div",{className:"flex flex-col gap-2",children:e.map((e,s)=>a.jsx("button",{onClick:()=>t(e),className:"w-full text-left bg-gray-100 text-gray-700 px-4 py-2.5 rounded-lg text-sm hover:bg-gray-200 transition-colors",children:e},s))})]}),w="user_123_demo",y=()=>{let[e,t]=(0,n.useState)([]),[s,l]=(0,n.useState)(!1),[c,u]=(0,n.useState)(!1),[x,h]=(0,n.useState)(!1),g=(0,n.useRef)([]);(0,n.useEffect)(()=>{g.current=e},[e]),(0,n.useEffect)(()=>{(async()=>{try{let e=await fetch(`/api/history?userId=${w}`);if(e.ok){let s=await e.json();s&&s.length>0?t(s):(t([o]),u(!0))}else t([o]),u(!0)}catch(e){console.error("Could not fetch history, starting new conversation.",e),t([o]),u(!0)}finally{h(!0)}})()},[]);let f=(0,n.useCallback)(async(e,a)=>{if(!e.trim()||s)return;u(!1),l(!0);let n={id:Date.now().toString(),role:r.USER,text:e},o=a??g.current,i=o[0]?.id==="initial"?[n]:[...o,n];t([...i,{id:(Date.now()+1).toString(),role:r.AI,text:""}]);try{let e=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:w,userMessage:n,history:i.slice(0,-1)})});if(!e.ok||!e.body)throw Error(`API request failed with status ${e.status}`);let s=e.body.getReader(),a=new TextDecoder,o="";for(;;){let{done:e,value:n}=await s.read();if(e)break;o+=a.decode(n),t(e=>{let t=[...e],s=t[t.length-1];return s?.role===r.AI&&(s.text=o),t})}}catch(e){console.error("Error sending message:",e),t(e=>{let t=[...e],s=t[t.length-1];return s?.role===r.AI&&(s.text="抱歉，连接服务器时遇到问题，请稍后再试。"),t})}finally{l(!1)}},[s]),y=(0,n.useCallback)(()=>{let e=g.current,t=e.findLastIndex(e=>e.role===r.USER);if(-1===t)return;let s=e[t],a=e.slice(0,t);f(s.text,a)},[f]);return x?(0,a.jsxs)("div",{className:"flex flex-col h-screen max-w-md mx-auto bg-white font-sans",children:[a.jsx(d,{}),a.jsx(p,{messages:e,isLoading:s,onRegenerate:y}),c&&a.jsx(b,{prompts:i,onSelect:e=>f(e)}),a.jsx(m,{onSend:e=>f(e),isLoading:s})]}):a.jsx("div",{className:"flex flex-col h-screen max-w-md mx-auto bg-white font-sans items-center justify-center",children:a.jsx("p",{className:"text-gray-600",children:"正在连接您的 AI 教练..."})})}},1506:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n,metadata:()=>a});var r=s(9510);s(1159),s(7272);let a={title:"AI Fitness Coach",description:"Your personal AI coach for fitness and workout advice."};function n({children:e}){return r.jsx("html",{lang:"en",children:r.jsx("body",{className:"bg-gray-50",children:e})})}},502:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var r=s(9510),a=s(8570);let n=(0,a.createProxy)(String.raw`/workspaces/AI-COACH/app/components/ChatClient.tsx`),{__esModule:o,$$typeof:i}=n;n.default;let l=(0,a.createProxy)(String.raw`/workspaces/AI-COACH/app/components/ChatClient.tsx#default`);function d(){return r.jsx(l,{})}},7272:()=>{}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,471],()=>s(716));module.exports=r})();