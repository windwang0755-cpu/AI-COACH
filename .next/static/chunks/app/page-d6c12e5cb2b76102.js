(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1697:function(e,t,s){Promise.resolve().then(s.bind(s,7026))},7026:function(e,t,s){"use strict";s.d(t,{default:function(){return y}});var r,a,l=s(7437),n=s(2265);(r=a||(a={})).USER="user",r.AI="ai";let o={id:"initial",role:a.AI,text:"Hello, I'm your personal AI coach, you can ask me anything about fitness and workouts."},i=["推荐3个有效的自重训练动作","建议一顿健康的训练后餐食","我如何提高身体柔韧性？"],c=()=>(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})});var d=()=>(0,l.jsxs)("header",{className:"flex items-center p-4 border-b border-gray-200 bg-white sticky top-0 z-10",children:[(0,l.jsx)("button",{className:"p-1 -ml-1","aria-label":"Go back",children:(0,l.jsx)(c,{})}),(0,l.jsx)("h1",{className:"text-lg font-semibold text-gray-800 text-center flex-grow -ml-6",children:"AI Coach"})]});let u=()=>(0,l.jsxs)("div",{className:"flex items-center justify-center space-x-1 p-1",children:[(0,l.jsx)("div",{className:"w-1.5 h-1.5 bg-gray-500 rounded-full animate-pulse [animation-delay:-0.3s]"}),(0,l.jsx)("div",{className:"w-1.5 h-1.5 bg-gray-500 rounded-full animate-pulse [animation-delay:-0.15s]"}),(0,l.jsx)("div",{className:"w-1.5 h-1.5 bg-gray-500 rounded-full animate-pulse"})]}),h=()=>(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),x=()=>(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h5M20 20v-5h-5M4 4a14.95 14.95 0 0113.138 5.5M20 20a14.95 14.95 0 01-13.138-5.5"})});var g=e=>{let{message:t,isLastMessage:s,isLoading:r,onRegenerate:n}=e,o=t.role===a.USER,i=t.role===a.AI;return(0,l.jsxs)("div",{className:"flex items-start gap-2.5 ".concat(o?"justify-end":""),children:[i&&(0,l.jsx)("img",{src:"https://picsum.photos/seed/aicoach/40/40",alt:"AI Coach",className:"w-8 h-8 rounded-full flex-shrink-0"}),(0,l.jsxs)("div",{className:"flex flex-col gap-1 w-full max-w-[85%] ".concat(o?"items-end":"items-start"),children:[(0,l.jsx)("div",{className:"rounded-2xl px-4 py-2.5 shadow-sm ".concat(o?"bg-blue-600 text-white rounded-br-lg":"bg-gray-100 text-gray-800 rounded-bl-lg"),children:i&&r&&s&&0===t.text.length?(0,l.jsx)(u,{}):(0,l.jsx)("p",{className:"whitespace-pre-wrap text-base",children:t.text})}),i&&!r&&s&&"initial"!==t.id&&(0,l.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,l.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(t.text)},"aria-label":"Copy message",className:"p-1.5 text-gray-500 hover:bg-gray-200 rounded-full transition-colors",children:(0,l.jsx)(h,{})}),(0,l.jsx)("button",{onClick:n,"aria-label":"Regenerate response",className:"p-1.5 text-gray-500 hover:bg-gray-200 rounded-full transition-colors",children:(0,l.jsx)(x,{})})]})]})]})},m=e=>{let{messages:t,isLoading:s,onRegenerate:r}=e,a=(0,n.useRef)(null);return(0,n.useEffect)(()=>{var e;null===(e=a.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[t]),(0,l.jsxs)("main",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[(0,l.jsx)("div",{role:"log",className:"space-y-4",children:t.map((e,a)=>(0,l.jsx)(g,{message:e,isLastMessage:a===t.length-1,isLoading:s,onRegenerate:r},e.id))}),(0,l.jsx)("div",{ref:a})]})};let f=e=>{let{disabled:t}=e;return(0,l.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,l.jsx)("path",{d:"M22 2L11 13",stroke:t?"#4B5563":"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,l.jsx)("path",{d:"M22 2L15 22L11 13L2 9L22 2Z",stroke:t?"#4B5563":"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})};var p=e=>{let{onSend:t,isLoading:s}=e,[r,a]=(0,n.useState)(""),o=(0,n.useRef)(null),i=e=>{e.preventDefault(),r.trim()&&!s&&(t(r),a(""),o.current&&(o.current.style.height="auto"))};return(0,l.jsx)("footer",{className:"bg-white p-2 sticky bottom-0 border-t border-gray-200",children:(0,l.jsxs)("form",{onSubmit:i,className:"flex items-end gap-2 bg-gray-800 rounded-xl p-2",children:[(0,l.jsx)("textarea",{ref:o,value:r,onChange:e=>{a(e.target.value)},onInput:()=>{let e=o.current;e&&(e.style.height="auto",e.style.height="".concat(Math.min(e.scrollHeight,128),"px"))},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),i(e))},placeholder:"输入任何内容...",className:"flex-1 bg-transparent text-white placeholder-gray-400 focus:outline-none resize-none overflow-y-auto text-base py-2 px-2",rows:1,disabled:s,"aria-label":"Chat input"}),(0,l.jsx)("button",{type:"submit",disabled:s||!r.trim(),className:"w-10 h-10 flex items-center justify-center rounded-full transition-colors duration-200 disabled:bg-gray-600 bg-blue-600 hover:bg-blue-700 flex-shrink-0","aria-label":"Send message",children:(0,l.jsx)(f,{disabled:s||!r.trim()})})]})})};let w=()=>(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h5M20 20v-5h-5M4 4a14.95 14.95 0 0113.138 5.5M20 20a14.95 14.95 0 01-13.138-5.5"})});var b=e=>{let{prompts:t,onSelect:s}=e;return(0,l.jsxs)("div",{className:"px-4 pb-2",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,l.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"你可以这样问"}),(0,l.jsx)("button",{className:"p-1 hover:bg-gray-200 rounded-full","aria-label":"Refresh suggestions",children:(0,l.jsx)(w,{})})]}),(0,l.jsx)("div",{className:"flex flex-col gap-2",children:t.map((e,t)=>(0,l.jsx)("button",{onClick:()=>s(e),className:"w-full text-left bg-gray-100 text-gray-700 px-4 py-2.5 rounded-lg text-sm hover:bg-gray-200 transition-colors",children:e},t))})]})};let j="user_123_demo";var y=()=>{let[e,t]=(0,n.useState)([]),[s,r]=(0,n.useState)(!1),[c,u]=(0,n.useState)(!1),[h,x]=(0,n.useState)(!1),g=(0,n.useRef)([]);(0,n.useEffect)(()=>{g.current=e},[e]),(0,n.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/history?userId=".concat(j));if(e.ok){let s=await e.json();s&&s.length>0?t(s):(t([o]),u(!0))}else t([o]),u(!0)}catch(e){console.error("Could not fetch history, starting new conversation.",e),t([o]),u(!0)}finally{x(!0)}})()},[]);let f=(0,n.useCallback)(async(e,l)=>{var n;if(!e.trim()||s)return;u(!1),r(!0);let o={id:Date.now().toString(),role:a.USER,text:e},i=null!=l?l:g.current,c=(null===(n=i[0])||void 0===n?void 0:n.id)==="initial"?[o]:[...i,o];t([...c,{id:(Date.now()+1).toString(),role:a.AI,text:""}]);try{let e=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:j,userMessage:o,history:c.slice(0,-1)})});if(!e.ok||!e.body)throw Error("API request failed with status ".concat(e.status));let s=e.body.getReader(),r=new TextDecoder,l="";for(;;){let{done:e,value:n}=await s.read();if(e)break;l+=r.decode(n),t(e=>{let t=[...e],s=t[t.length-1];return(null==s?void 0:s.role)===a.AI&&(s.text=l),t})}}catch(e){console.error("Error sending message:",e),t(e=>{let t=[...e],s=t[t.length-1];return(null==s?void 0:s.role)===a.AI&&(s.text="抱歉，连接服务器时遇到问题，请稍后再试。"),t})}finally{r(!1)}},[s]),w=(0,n.useCallback)(()=>{let e=g.current,t=e.findLastIndex(e=>e.role===a.USER);if(-1===t)return;let s=e[t],r=e.slice(0,t);f(s.text,r)},[f]);return h?(0,l.jsxs)("div",{className:"flex flex-col h-screen max-w-md mx-auto bg-white font-sans",children:[(0,l.jsx)(d,{}),(0,l.jsx)(m,{messages:e,isLoading:s,onRegenerate:w}),c&&(0,l.jsx)(b,{prompts:i,onSelect:e=>f(e)}),(0,l.jsx)(p,{onSend:e=>f(e),isLoading:s})]}):(0,l.jsx)("div",{className:"flex flex-col h-screen max-w-md mx-auto bg-white font-sans items-center justify-center",children:(0,l.jsx)("p",{className:"text-gray-600",children:"正在连接您的 AI 教练..."})})}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=1697)}),_N_E=e.O()}]);